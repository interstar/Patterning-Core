<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patterning Workbench</title>
    <link rel="stylesheet" href="style.css">

    <!-- CodeMirror 5 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/theme/material-darker.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/mode/clojure/clojure.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.9/addon/edit/matchbrackets.js"></script>

</head>
<body>
    <div class="header">
        <h1>Patterning : Project RoseEngine</h1>
        <div class="download-buttons">
            <button id="toggle-palette" class="download-btn palette-btn">Palette</button>
            <button id="copy-code" class="download-btn">Copy Code</button>
            <button id="save-code" class="download-btn">Save Code</button>
            <button id="load-code" class="download-btn">Load Code</button>
            <input type="file" id="file-input" accept=".cljs,.clj,.txt" style="display: none;">

            <button id="download-svg" class="download-btn">Download SVG</button>
            <button id="download-png" class="download-btn">Download PNG</button>
            <button id="download-edn" class="download-btn">Download EDN</button>
        </div>
    </div>
    
    <div class="workbench-container">
        <div class="code-pane">
            <div id="editor-container" class="code-editor">
                <!-- CodeMirror will be attached here -->
            </div>
            <div id="error-display" class="error-display"></div>
        </div>
        <div class="canvas-pane">
            <div class="pattern-container">
                <div id="canvas-container">
                    <!-- p5.js canvas will be attached here -->
                </div>
            </div>
            
        </div>
    </div>

    <div id="palette-modal" class="palette-modal" aria-hidden="true">
        <div class="palette-card" role="dialog" aria-modal="false" aria-labelledby="palette-title">
            <div class="palette-header">
                <div id="palette-title" class="palette-title">Standard Palette</div>
                <button id="close-palette" class="palette-close" aria-label="Close palette">Close</button>
            </div>
            <div id="palette-grid" class="palette-grid"></div>
        </div>
    </div>

    <!-- Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    
    <!-- Load the compiled workbench directly -->
    <script src="workbench.js"></script>
    <script>
        // Wait for the workbench namespace to be available
        function startWorkbench() {
            if (typeof workbench !== 'undefined' && workbench["-main"]) {
                console.log("Starting workbench...");
                workbench["-main"]();
            } else {
                console.log("Workbench not ready, retrying...");
                setTimeout(startWorkbench, 100);
            }
        }
        startWorkbench();
    </script>

</body>
</html>
